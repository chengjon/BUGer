apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: buger-ingress
  namespace: buger-system
  labels:
    app: buger
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/rate-limit: "100"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "30"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "30"
    nginx.ingress.kubernetes.io/cors-allow-origin: "*"
    nginx.ingress.kubernetes.io/enable-cors: "true"
spec:
  ingressClassName: nginx
  tls:
  - hosts:
    - buger.example.com
    secretName: buger-tls-cert
  rules:
  - host: buger.example.com
    http:
      paths:
      - path: /api
        pathType: Prefix
        backend:
          service:
            name: buger-app-internal
            port:
              number: 3050
      - path: /health
        pathType: Prefix
        backend:
          service:
            name: buger-app-internal
            port:
              number: 3050
      - path: /metrics
        pathType: Prefix
        backend:
          service:
            name: buger-app-internal
            port:
              number: 9090

---
apiVersion: v1
kind: Secret
metadata:
  name: buger-tls-cert
  namespace: buger-system
  labels:
    app: buger
type: kubernetes.io/tls
data:
  # 注意：以下是示例证书，生产环境请使用真实证书
  # 生成方式: openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCekNDQWUrZ0F3SUJBZ0lVSVQ2b24wclBDeFhGNXZkK1lDZWI5THhZQkUwd0RRWUpLb1pJaGtDQVFzRkFEQnkKTVFzd0NRWURWUVFHREFKVGFDZ1dSRWQzWld4dllrNVVSazlVWjBSQk1SUXdEZ1lEVlFRSUV3ZFRXVkZHVTJGdQpkbEJ1YjJSbE1SVXdFd1lEVlFRSEV3eFlWVkp1YjI1bGNtOXlZWFJ2TVJrd0Z3WURWUVFLRXgwS1JGOTBSRzluClpXNTBNQjRYRFRJdk1qTTBOakExTWpNME5Gb1hEVEk1TWpNME1qQXhOekJhTUJNeEN6QUpCZ05WQkFZVEFrTkIKTVFzd0NRWURWUVFJRXN4V25CMEX3g0q3o3Z3b3N6V1psVjBSQk1SUXdEZ1lEVlFRSUV3ZFRXVkZHVTJGdQpkbEJ1YjJSbE1SVXdFd1lEVlFRSEV3eFlWVkp1YjI1bGNtOXlZWFJ2TURBM01pRldNQVFHQ1NxR1NNNDNCdFdjCjBGQkFIQkFkMEFNQU1CZ05WSFJNRUJUQUdCQVFIQ1FBQ0NBUXA=
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUU0Z0lCQkFLQmdRRGVHVmJPMDhNRXBSFUpFWURVUVFRSUV3eFlWVkp1YjI1bGNtOXlZWFJ2TURBM01pRldNQVFHQ1NxR1NNNDNCdFdjCjBGQkFIQkFkMEFNQU1CZ05WSFJNRUJUQUdCQVFIQ1FBQ0NBUXA=
